<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DJ Upload</title>

  <link rel="stylesheet" href="https://dance-offs.com/style2.css?v=2004">

  <style>
    body.dj-upload {
      padding-bottom: 80px;
    }

    .dj-booth {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
      margin: 30px auto;
    }

    .deck-row {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      width: 100%;
    }

    .mixer-wrap {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    .mixer {
      max-width: 350px;
      width: 100%;
    }

    .dj-library {
      width: 100%;
      max-width: 900px;
      margin: 40px auto;
      border-collapse: collapse;
      color: white;
    }

    .dj-library th, .dj-library td {
      padding: 12px;
      border-bottom: 1px solid #333;
      text-align: center;
    }

    .dj-library audio {
      width: 180px;
    }

    .library-title {
      text-align: center;
      margin-top: 50px;
      font-size: 28px;
      font-weight: 700;
      color: #ffcc00;
    }
  </style>
</head>

<body class="dj-upload">

  <nav class="navbar">
    <a href="https://dance-offs.com/index.html">Home</a>
    <a href="https://dance-offs.com/dancers.html">Dancers</a>
    <a href="https://upload.dance-offs.com/uploads/djs.html" class="active">DJs</a>
    <a href="https://dance-offs.com/vote.html">Vote</a>
    <a href="https://dance-offs.com/prizes.html">Prizes</a>
    <a href="https://dance-offs.com/shop.html">Shop</a>
  </nav>

  <div class="dj-booth">

    <div class="deck-row">
      <div class="deck">
        <div class="deck-title">Deck 1</div>
        <input type="text" id="deck1Artist" placeholder="Artist" required>
        <input type="text" id="deck1Title" placeholder="Track Title" required>
      </div>

      <div class="deck">
        <div class="deck-title">Deck 2</div>
        <input type="text" id="deck2Artist" placeholder="Artist" required>
        <input type="text" id="deck2Title" placeholder="Track Title" required>
      </div>
    </div>

    <div class="mixer-wrap">
      <div class="mixer">
        <input type="email" id="djEmail" placeholder="Your Email (DJ ID)" required>
        <input type="text" id="djName" placeholder="DJ Name" required>

        <label class="upload-label">
          Upload MP3 only <span style="color:#fff;">(~10 minutes max)</span>
        </label>

        <input type="file" id="djFile" accept=".mp3,audio/mpeg" required>

        <button id="uploadBtn" class="upload-button">Upload Mix</button>

        <div id="uploadStatus"></div>

        <audio id="djPlayer" controls style="width:100%; margin-top:20px; display:none;"></audio>
      </div>
    </div>

  </div>

  <h2 class="library-title">Past Uploads</h2>

  <table class="dj-library" id="djLibrary">
    <thead>
      <tr>
        <th>DJ Name</th>
        <th>Track</th>
        <th>Preview</th>
        <th>Booking</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <footer class="footer">
    Â© 2026 Dance-Offs. All rights reserved.
  </footer>

  <script>
    const BACKEND_URL =
      "https://script.google.com/macros/s/AKfycbxUMisR1LVFdL2n6COU-DlYXBLesPSJAVLofrAvZqYapgTRr--ybmKWZYqSY5S0rncj/exec";

    async function loadLatestMix() {
      try {
        const res = await fetch(BACKEND_URL + "?mode=djlist");
        const list = await res.json();
        if (!list.length) return;

        const latest = list[list.length - 1];

        const player = document.getElementById("djPlayer");
        player.src = latest.fileUrl;
        player.style.display = "block";

      } catch (err) {
        console.error("Could not load latest mix:", err);
      }
    }

    async function loadLibrary() {
      try {
        const res = await fetch(BACKEND_URL + "?mode=djlist");
        const list = await res.json();

        const tbody = document.querySelector("#djLibrary tbody");
        tbody.innerHTML = "";

        list.reverse();

        list.forEach(row => {
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${row.djName}</td>

            <td>
              ${row.deck1Title} (${row.deck1Artist})
              vs.
              ${row.deck2Title} (${row.deck2Artist})
            </td>

            <td>
              <audio controls src="${row.fileUrl}" style="width:160px;"></audio>
            </td>

            <td>
              <a href="mailto:office@dance-offs.com?subject=Book%20DJ%20${encodeURIComponent(row.djName)}">
                Book DJ
              </a>
            </td>
          `;

          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error("Library load failed:", err);
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadLatestMix();
      loadLibrary();
    });

    document.getElementById("uploadBtn").addEventListener("click", async () => {
      const status = document.getElementById("
