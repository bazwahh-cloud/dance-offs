<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dance Offs - Vote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #fff;
    }

    header {
      padding: 10px 16px;
      background: #111;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header .logo {
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 14px;
    }

    header nav a {
      color: #ccc;
      text-decoration: none;
      margin-left: 16px;
      font-size: 14px;
    }

    header nav a:hover {
      color: #fff;
    }

    main {
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .battle-grid {
      display: table;
      width: 100%;
      border-spacing: 16px 0;
    }

    .battle-col {
      display: table-cell;
      vertical-align: top;
      width: 50%;
    }

    .video-box {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      background: #111;
      border-radius: 8px;
      overflow: hidden;
    }

    .video-box iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .vote-btn {
      margin-top: 8px;
      width: 100%;
      padding: 10px 0;
      border-radius: 999px;
      border: 1px solid #444;
      background: #222;
      color: #fff;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
    }

    .vote-btn:hover {
      background: #333;
    }

    .sound-section {
      margin-top: 24px;
    }

    .sound-section h2 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 8px;
      color: #aaa;
    }

    .sound-box {
      width: 100%;
      border-radius: 8px;
      overflow: hidden;
      background: #111;
    }

    .sound-box iframe {
      width: 100%;
      height: 166px;
      border: 0;
    }

    .status {
      margin-top: 12px;
      font-size: 13px;
      color: #aaa;
    }

    @media (max-width: 768px) {
      .battle-grid {
        display: block;
      }
      .battle-col {
        display: block;
        width: 100%;
        margin-bottom: 16px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Dance Offs</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="dancers.html">Dancers</a>
      <a href="vote.html">Vote</a>
    </nav>
  </header>

  <main>
    <div class="battle-grid">
      <div class="battle-col">
        <div class="video-box" id="left-video"></div>
        <button class="vote-btn" id="vote-left">Vote Left</button>
      </div>
      <div class="battle-col">
        <div class="video-box" id="right-video"></div>
        <button class="vote-btn" id="vote-right">Vote Right</button>
      </div>
    </div>

    <div class="sound-section">
      <h2>Now Playing</h2>
      <div class="sound-box" id="sound-box"></div>
    </div>

    <div class="status" id="status"></div>
  </main>

  <script>
    const BASE_URL = "https://script.google.com/macros/s/AKfycbwuOUEAuAE4CfauFw9Xxv3BJenwCUaUNakrb7DTeTjJLZMK8S1hCXbcLRBHCY3FoFZD_g/exec";

    function extractYouTubeID(url) {
      if (!url) return null;
      try {
        if (url.indexOf("youtu.be/") !== -1) {
          return url.split("youtu.be/")[1].split(/[?&]/)[0];
        }
        if (url.indexOf("watch?v=") !== -1) {
          return url.split("watch?v=")[1].split(/[?&]/)[0];
        }
        if (url.indexOf("/embed/") !== -1) {
          return url.split("/embed/")[1].split(/[?&]/)[0];
        }
      } catch (e) {}
      return null;
    }

    function setVideo(containerId, url) {
      const id = extractYouTubeID(url);
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      if (!id) return;
      const iframe = document.createElement("iframe");
      iframe.src = "https://www.youtube.com/embed/" + id;
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
      iframe.allowFullscreen = true;
      container.appendChild(iframe);
    }

    function loadWeeklyBattle() {
      fetch(BASE_URL + "?mode=getweeklybattle")
        .then(r => r.json())
        .then(data => {
          setVideo("left-video", data.left);
          setVideo("right-video", data.right);
        })
        .catch(err => {
          document.getElementById("status").textContent = "Error loading battle.";
          console.log(err);
        });
    }

    function loadSound() {
      fetch(BASE_URL + "?mode=getsound")
        .then(r => r.json())
        .then(data => {
          const box = document.getElementById("sound-box");
          box.innerHTML = "";
          if (!data.sound) return;
          const iframe = document.createElement("iframe");
          iframe.src = "https://w.soundcloud.com/player/?url=" + encodeURIComponent(data.sound);
          iframe.allow = "autoplay";
          box.appendChild(iframe);
        })
        .catch(err => {
          console.log(err);
        });
    }

    function sendVote(side) {
      fetch(BASE_URL + "?mode=vote&side=" + encodeURIComponent(side))
        .then(r => r.text())
        .then(txt => {
          document.getElementById("status").textContent = "Vote recorded for " + side.toUpperCase() + ".";
        })
        .catch(err => {
          document.getElementById("status").textContent = "Error sending vote.";
          console.log(err);
        });
    }

    document.getElementById("vote-left").addEventListener("click", () => sendVote("LEFT"));
    document.getElementById("vote-right").addEventListener("click", () => sendVote("RIGHT"));

    loadWeeklyBattle();
    loadSound();
  </script>
</body>
</html>
