function submitVote() {
  if (!currentTransactionID) {
    alert("Payment required before voting.");
    return;
  }

  const choice = document.querySelector('input[name="voteChoice"]:checked');
  if (!choice) return;

  const side = choice.value;
  const dancerName = side === "champion" ? champion.dancer : challenger.dancer;
  const dancerURL  = side === "champion" ? champion.url    : challenger.url;

  const formData = new URLSearchParams();
  formData.append("mode", "vote");

  // FIELD NAMES FIXED TO MATCH BACKEND
  formData.append("battle", currentBattleID);
  formData.append("side", side);
  formData.append("tx", currentTransactionID);
  formData.append("email", window.currentVoterEmail || "");

  // Winner info (your backend uses these names)
  formData.append("WinnerName", dancerName);
  formData.append("WinnerURL", dancerURL);

  fetch(endpoint, { method: "POST", body: formData })
    .then(r => r.text())
    .then(text => {
      if (text.includes("Voting closed")) {
        alert("Voting is now closed for this battle.");
        return;
      }

      window.location.href =
        "thankyou.html?battle=" + currentBattleID + "&tx=" + currentTransactionID;
    });
}
