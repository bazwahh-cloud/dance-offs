<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Dance-Offs: Vote</title>

  <link rel="stylesheet" href="style2.css?v=4001">
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <script src="https://www.paypal.com/sdk/js?client-id=AX4Xv6G1hrF13n76DY6HPyTIOK13Gkz7Af3OqQMarnqPXRmhqtOb733jfZnetspN-HH7CZh_MFSRsIN8&currency=GBP&components=buttons"></script>

  <style>
    #loadingOverlay {
      position: fixed !important;
      inset: 0 !important;
      background: rgba(0,0,0,0.9);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-size: 28px;
      font-family: 'Bangers', cursive;
      letter-spacing: 1px;
      z-index: 999999999 !important;
      text-align: center;
      transition: opacity 0.4s ease;
      isolation: isolate; /* CRITICAL FIX */
    }

    .video-slot {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
    }

    .video-slot iframe.battle-frame {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .play-overlay {
      position: absolute !important;
      inset: 0 !important;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.45);
      z-index: 10;
      cursor: pointer;
      transition: opacity 0.25s ease;
    }

    .play-overlay.hidden {
      opacity: 0;
      pointer-events: none !important;
    }

    .play-overlay .icon {
      font-size: 64px;
      color: #ffcc00;
      text-shadow: 0 0 10px #000;
    }

    @media (max-width: 600px) {
      .play-overlay .icon {
        font-size: 48px;
      }
    }

    .vote-option input[type="radio"] {
      display: none;
    }

    .vote-box {
      width: 100%;
      max-width: 240px;
      padding: 18px;
      background: #111;
      border: 3px solid #333;
      border-radius: 12px;
      text-align: center;
      cursor: not-allowed;
      opacity: 0.5;
      transition: 0.25s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      margin: 15px auto 0;
    }

    .vote-title {
      font-size: 20px;
      font-weight: 700;
      color: #ffcc00;
      letter-spacing: 1px;
    }

    .vote-option.enabled:hover .vote-box {
      border-color: #ffcc00;
      background: #1a1a1a;
      transform: translateY(-3px);
      opacity: 1;
    }

    .vote-option input[type="radio"]:checked + .vote-box {
      border-color: #ffcc00;
      background: #222;
      box-shadow: 0 0 12px rgba(255,204,0,0.6);
      transform: translateY(-4px);
      opacity: 1;
    }

    .vote-option.enabled .vote-box {
      cursor: pointer;
      opacity: 1;
    }

    #voteInstruction {
      text-align: center;
      font-size: 16px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0;
    }
  </style>
</head>

<body class="vote-page-only">

  <div id="loadingOverlay">Loading battle… please wait</div>

  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="dancers.html">Dancers</a>
    <a href="https://upload.dance-offs.com/uploads/djs.html">DJs</a>
    <a href="vote.html" class="active">Vote</a>
    <a href="prizes.html">Prizes</a>
    <a href="shop.html">Shop</a>
  </nav>

  <p id="countdownTimer" style="text-align:center; margin-top:15px; font-size:20px;"></p>

  <div id="voteInstruction">Voting locked — complete payment to continue.</div>

  <main class="page-container">

    <div class="vote-layout">

      <div class="vote-column">
        <div id="championVideo"></div>

        <label class="vote-option">
          <input type="radio" name="voteChoice" value="champion" id="voteChampionOption" disabled onclick="submitVote()">
          <div class="vote-box">
            <span class="vote-title">Vote Champion</span>
          </div>
        </label>
      </div>

      <div class="vote-column">
        <h2 style="font-family:'Bangers', cursive; font-size:32px;">Vote for £1.50</h2>
        <p style="color:#ccc; margin-bottom:10px;">Pay £1.50 to unlock your vote.</p>

        <div style="width:260px; margin:auto; transform:scale(0.85); transform-origin:top center;">
          <div id="paypal-button-container"></div>
        </div>
      </div>

      <div class="vote-column">
        <div id="challengerVideo"></div>

        <label class="vote-option">
          <input type="radio" name="voteChoice" value="challenger" id="voteChallengerOption" disabled onclick="submitVote()">
          <div class="vote-box">
            <span class="vote-title">Vote Challenger</span>
          </div>
        </label>
      </div>

    </div>

    <section id="voteProgressSection" style="margin-top:30px; text-align:center;">

      <h3 style="font-family:'Bangers', cursive; font-size:26px; margin-bottom:15px;">
        Vote Progress
      </h3>

      <div style="margin-bottom:20px;">
        <div id="championCount" class="vote-count" style="font-size:16px;">
          Champion Votes: 0
        </div>

        <div class="progress-wrapper" style="margin-top:6px;">
          <div id="championBar" class="progress-bar champion-bar"></div>
        </div>
      </div>

      <div>
        <div id="challengerCount" class="vote-count" style="font-size:16px;">
          Challenger Votes: 0
        </div>

        <div class="progress-wrapper" style="margin-top:6px;">
          <div id="challengerBar" class="progress-bar challenger-bar"></div>
        </div>
      </div>

      <div style="margin-top:10px; font-size:14px; color:#ccc;">
        <span id="remainingVotesText">Remaining votes: 200</span>
      </div>

    </section>

    <div style="margin-top:40px; text-align:center;">
      <h3 style="font-family:'Bangers', cursive; font-size:28px; margin-bottom:10px;">
        Now Playing
      </h3>
      <p id="djTrackName" style="color:#ccc; margin-bottom:10px;"></p>

      <audio id="djPlayer" controls playsinline style="width:100%; max-width:500px;"></audio>
    </div>

  </main>

  <footer class="footer">
    © 2026 Dance-Offs. All rights reserved.
    <br>
    <a href="https://dance-offs.com/tnc.html" style="color:#ffcc00; text-decoration:underline;">
      Terms & Conditions
    </a>
  </footer>

<script>
          const mins = Math.floor((diff / 60000) % 60);
          const secs = Math.floor((diff / 1000) % 60);

          document.getElementById("countdownTimer").innerText =
            `Next battle in ${days}d ${hours}h ${mins}m ${secs}s`;
        }

        updateTimer();
        setInterval(updateTimer, 1000);
      });
  }

  window.onload = async function () {
    // Load battle (auto-hides overlay when done)
    loadBattle();

    // Load DJ track (no autoplay)
    loadDJTrack();

    // Start countdown
    loadCountdown();

    // Load vote counts
    setTimeout(loadVoteCounts, 1000);
    setInterval(loadVoteCounts, 5000);
  };
</script>

</body>
</html>
